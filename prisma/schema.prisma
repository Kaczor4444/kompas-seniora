// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
  previewFeatures = ["driverAdapters"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Placowka {
  id                Int      @id @default(autoincrement())
  nazwa             String
  typ_placowki      String
  prowadzacy        String?
  ulica             String?
  miejscowosc       String
  kod_pocztowy      String?
  gmina             String?
  powiat            String
  wojewodztwo       String
  telefon           String?
  email             String?
  www               String?
  liczba_miejsc     Int?
  profil_opieki     String?
  koszt_pobytu      Float?
  data_aktualizacji DateTime?
  zrodlo            String?
  latitude          Float?
  longitude         Float?
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  // Relations
  analytics         PlacowkaAnalytics?
  snapshots         PlacowkaSnapshot[]

  @@index([powiat])
  @@index([wojewodztwo])
  @@index([typ_placowki])
}

model TerytLocation {
  id                 Int     @id @default(autoincrement())
  nazwa              String
  nazwa_normalized   String
  typ                String
  gmina              String?
  powiat             String
  wojewodztwo        String

  @@index([nazwa_normalized])
  @@index([powiat])
  @@index([wojewodztwo])
}

model SharedList {
  id       Int      @id @default(autoincrement())
  token    String   @unique
  ids      String
  created  DateTime @default(now())
  views    Int      @default(0)

  @@index([token])
  @@index([created])
}

// ðŸ†• NEW MODEL: Analytics for tracking user interactions with facilities
model PlacowkaAnalytics {
  id              Int      @id @default(autoincrement())
  placowkaId      Int      @unique
  totalViews      Int      @default(0)
  uniqueVisitors  Int      @default(0)
  phoneClicks     Int      @default(0)
  emailClicks     Int      @default(0)
  websiteClicks   Int      @default(0)
  favoritesCount  Int      @default(0)
  comparesCount   Int      @default(0)
  sharesCount     Int      @default(0)
  lastViewed      DateTime?
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  
  // Relations
  placowka        Placowka @relation(fields: [placowkaId], references: [id], onDelete: Cascade)

  @@index([placowkaId])
  @@index([totalViews])
  @@index([phoneClicks])
  @@index([lastViewed])
}

// ðŸ†• NEW MODEL: MOPS (Municipal Social Assistance Centers) contact database
model MopsContact {
  id            Int      @id @default(autoincrement())
  city          String   @unique // normalized: "krakÃ³w", "wieliczka"
  cityDisplay   String            // display: "KrakÃ³w", "Wieliczka"
  name          String            // "Miejski OÅ›rodek Pomocy SpoÅ‚ecznej w Krakowie"
  phone         String
  email         String?
  address       String
  website       String?
  wojewodztwo   String            // "maÅ‚opolskie", "Å›lÄ…skie"
  verified      Boolean  @default(false)
  lastVerified  DateTime?
  notes         String?          // internal notes about this MOPS
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  @@index([city])
  @@index([wojewodztwo])
  @@index([verified])
}

// ðŸ†• NEW MODEL: Historical snapshots of facilities for year-over-year analysis
model PlacowkaSnapshot {
  id              Int      @id @default(autoincrement())
  placowkaId      Int
  rok             Int      // Year: 2023, 2024, 2025...
  
  // Snapshot of data for this year
  nazwa           String
  typ_placowki    String
  miejscowosc     String
  powiat          String
  wojewodztwo     String
  koszt_pobytu    Float?
  liczba_miejsc   Int?
  profil_opieki   String?
  status          String   @default("aktywna") // "aktywna" | "zamkniÄ™ta" | "nowa"
  
  createdAt       DateTime @default(now())
  
  // Relations
  placowka        Placowka @relation(fields: [placowkaId], references: [id], onDelete: Cascade)
  
  @@unique([placowkaId, rok])
  @@index([placowkaId])
  @@index([rok])
  @@index([wojewodztwo, rok])
}

// ðŸ†• NEW MODEL: Aggregated statistics per voivodeship per year
model WojewodztwoStats {
  id                  Int      @id @default(autoincrement())
  wojewodztwo         String
  rok                 Int      // Year: 2023, 2024, 2025...
  
  // Aggregated statistics
  liczba_dps          Int      // Number of DPS facilities
  liczba_sds          Int      // Number of ÅšDS facilities
  total_placowek      Int      // Total facilities (DPS + ÅšDS)
  total_miejsc        Int      // Total capacity (all facilities)
  sredni_koszt_dps    Float?   // Average cost for DPS
  sredni_koszt_sds    Float?   // Average cost for ÅšDS
  min_koszt           Float?   // Cheapest facility
  max_koszt           Float?   // Most expensive facility
  
  createdAt           DateTime @default(now())
  updatedAt           DateTime @updatedAt
  
  @@unique([wojewodztwo, rok])
  @@index([wojewodztwo])
  @@index([rok])
}